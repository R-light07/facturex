<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Faturação</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="logo">
                <i class="fas fa-receipt"></i>
                <span>Facturex</span>
            </div>
            <ul class="nav-menu">
                <li class="nav-item active">
                    <a href="#" class="nav-link" onclick="showSection('fatura')">
                        <i class="fas fa-file-invoice"></i>
                        <span>Nova Fatura</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="showSection('clientes')">
                        <i class="fas fa-users"></i>
                        <span>Clientes</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="showSection('historico')">
                        <i class="fas fa-history"></i>
                        <span>Histórico</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="showSection('relatorios')">
                        <i class="fas fa-chart-bar"></i>
                        <span>Relatórios</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Seção de Faturação -->
            <section id="fatura" class="content-section active">
                <div class="section-header">
                    <h1>Nova Fatura</h1>
                    <p>Crie e gere suas faturas de forma simples</p>
                </div>

                <div class="invoice-container">
                    <div class="form-card">
                        <div class="card-header">
                            <h2>Dados da Fatura</h2>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="clienteSelect">Cliente</label>
                                <div class="select-wrapper">
                                    <select id="clienteSelect" onchange="carregarDadosCliente()">
                                        <option value="">Selecione um cliente</option>
                                    </select>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <button class="btn-secondary btn-sm" onclick="showSection('clientes')">
                                    <i class="fas fa-plus"></i> Novo Cliente
                                </button>
                            </div>

                            <div class="form-group">
                                <label for="dataFatura">Data da Fatura</label>
                                <input type="date" id="dataFatura">
                            </div>
                        </div>

                        <div class="items-section">
                            <div class="section-title">
                                <h3>Itens da Fatura</h3>
                            </div>
                            <div class="items-container" id="items-container">
                                <div class="item-header">
                                    <span>Descrição</span>
                                    <span>Qtd</span>
                                    <span>Preço</span>
                                    <span>Total</span>
                                    <span></span>
                                </div>
                                <div class="item-row">
                                    <input type="text" class="item-descricao" placeholder="Descrição do item">
                                    <input type="number" class="item-quantidade" value="1" min="1">
                                    <input type="number" class="item-preco" value="0" step="0.01" min="0">
                                    <span class="item-total">0.00</span>
                                    <button class="btn-remove" onclick="removerItem(this)" disabled>
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <button class="btn-add-item" onclick="adicionarItem()">
                                <i class="fas fa-plus"></i> Adicionar Item
                            </button>
                        </div>

                        <div class="summary-section">
                            <div class="summary-grid">
                                <div class="summary-group">
                                    <label for="iva">Taxa IVA (%)</label>
                                    <input type="number" id="iva" value="16" min="0" max="100">
                                </div>
                                <div class="summary-totals">
                                    <div class="total-line">
                                        <span>Subtotal:</span>
                                        <span id="subtotal">0.00</span>
                                    </div>
                                    <div class="total-line">
                                        <span>IVA:</span>
                                        <span id="valor-iva">0.00</span>
                                    </div>
                                    <div class="total-line grand-total">
                                        <span>Total:</span>
                                        <span id="total">0.00 MZN</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="actions">
                            <button class="btn-primary" onclick="gerarFatura()">
                                <i class="fas fa-file-pdf"></i> Gerar Fatura
                            </button>
                            <button class="btn-secondary" onclick="limparFormulario()">
                                <i class="fas fa-broom"></i> Limpar
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Seção de Clientes -->
            <section id="clientes" class="content-section">
                <div class="section-header">
                    <h1>Gestão de Clientes</h1>
                    <p>Adicione e gerencie seus clientes</p>
                </div>

                <div class="clients-container">
                    <div class="clients-actions">
                        <button class="btn-primary" onclick="abrirModalCliente()">
                            <i class="fas fa-user-plus"></i> Novo Cliente
                        </button>
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="searchClient" placeholder="Pesquisar clientes...">
                        </div>
                    </div>

                    <div class="clients-grid" id="clients-grid">
                        <!-- Clientes serão carregados aqui -->
                    </div>
                </div>
            </section>

            <!-- Seção de Histórico -->
            <section id="historico" class="content-section">
                <div class="section-header">
                    <h1>Histórico de Faturas</h1>
                    <p>Visualize suas faturas anteriores</p>
                </div>
                <div class="history-container">
                    <div class="history-list" id="historyList">
                        <div class="empty-state">
                            <i class="fas fa-receipt"></i>
                            <h3>Nenhuma fatura gerada</h3>
                            <p>As faturas que você criar aparecerão aqui</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Seção de Relatórios -->
            <section id="relatorios" class="content-section">
                <div class="section-header">
                    <h1>Relatórios e Documentos</h1>
                    <p>Gere e exporte relatórios das suas faturas</p>
                </div>

                <div class="reports-container">
                    <div class="reports-actions">
                        <div class="report-filters">
                            <div class="form-group">
                                <label for="dataInicio">Data Início</label>
                                <input type="date" id="dataInicio">
                            </div>
                            <div class="form-group">
                                <label for="dataFim">Data Fim</label>
                                <input type="date" id="dataFim">
                            </div>
                            <div class="form-group">
                                <label for="clienteRelatorio">Cliente</label>
                                <select id="clienteRelatorio">
                                    <option value="">Todos os Clientes</option>
                                </select>
                            </div>
                            <button class="btn-primary" onclick="gerarRelatorio()">
                                <i class="fas fa-chart-bar"></i> Gerar Relatório
                            </button>
                        </div>
                    </div>

                    <div class="reports-summary">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-receipt"></i>
                                </div>
                                <div class="stat-info">
                                    <span class="stat-value" id="totalFaturas">0</span>
                                    <span class="stat-label">Total Faturas</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-euro-sign"></i>
                                </div>
                                <div class="stat-info">
                                    <span class="stat-value" id="totalVendas">0.00 €</span>
                                    <span class="stat-label">Total Vendas</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="stat-info">
                                    <span class="stat-value" id="mediaFatura">0.00 €</span>
                                    <span class="stat-label">Média por Fatura</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-percentage"></i>
                                </div>
                                <div class="stat-info">
                                    <span class="stat-value" id="totalIVA">0.00 €</span>
                                    <span class="stat-label">Total IVA</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="reports-results">
                        <div class="results-header">
                            <h3>Faturas do Período</h3>
                            <div class="export-actions">
                                <button class="btn-secondary" onclick="exportarPDF()">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                                <button class="btn-secondary" onclick="exportarExcel()">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button class="btn-secondary" onclick="exportarCSV()">
                                    <i class="fas fa-file-csv"></i> CSV
                                </button>
                            </div>
                        </div>
                        <div class="results-table">
                            <table id="tabelaRelatorios">
                                <thead>
                                    <tr>
                                        <th>Número</th>
                                        <th>Data</th>
                                        <th>Cliente</th>
                                        <th>Subtotal</th>
                                        <th>IVA</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody id="corpoTabelaRelatorios">
                                    <!-- Dados serão preenchidos via JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Seção de Relatórios -->
            <section id="relatorios" class="content-section">
                <div class="section-header">
                    <h1>Relatórios e Documentos</h1>
                    <p>Gere e exporte relatórios das suas faturas</p>
                </div>

                <div class="reports-container">
                    <div class="reports-actions">
                        <div class="report-filters">
                            <div class="form-group">
                                <label for="dataInicio">Data Início</label>
                                <input type="date" id="dataInicio">
                            </div>
                            <div class="form-group">
                                <label for="dataFim">Data Fim</label>
                                <input type="date" id="dataFim">
                            </div>
                            <div class="form-group">
                                <label for="clienteRelatorio">Cliente</label>
                                <select id="clienteRelatorio">
                                    <option value="">Todos os Clientes</option>
                                </select>
                            </div>
                            <button class="btn-primary" onclick="gerarRelatorio()">
                                <i class="fas fa-chart-bar"></i> Gerar Relatório
                            </button>
                        </div>
                    </div>

                    <div class="reports-summary">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-receipt"></i>
                                </div>
                                <div class="stat-info">
                                    <span class="stat-value" id="totalFaturas">0</span>
                                    <span class="stat-label">Total Faturas</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-euro-sign"></i>
                                </div>
                                <div class="stat-info">
                                    <span class="stat-value" id="totalVendas">0.00 €</span>
                                    <span class="stat-label">Total Vendas</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="stat-info">
                                    <span class="stat-value" id="mediaFatura">0.00 €</span>
                                    <span class="stat-label">Média por Fatura</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-percentage"></i>
                                </div>
                                <div class="stat-info">
                                    <span class="stat-value" id="totalIVA">0.00 €</span>
                                    <span class="stat-label">Total IVA</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="reports-results">
                        <div class="results-header">
                            <h3>Faturas do Período</h3>
                            <div class="export-actions">
                                <button class="btn-secondary" onclick="exportarPDF()">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                                <button class="btn-secondary" onclick="exportarExcel()">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button class="btn-secondary" onclick="exportarCSV()">
                                    <i class="fas fa-file-csv"></i> CSV
                                </button>
                            </div>
                        </div>
                        <div class="results-table">
                            <table id="tabelaRelatorios">
                                <thead>
                                    <tr>
                                        <th>Número</th>
                                        <th>Data</th>
                                        <th>Cliente</th>
                                        <th>Subtotal</th>
                                        <th>IVA</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody id="corpoTabelaRelatorios">
                                    <!-- Dados serão preenchidos via JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Modal de Cliente -->
    <div id="clientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Novo Cliente</h3>
                <button class="btn-close" onclick="fecharModalCliente()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="clientForm" onsubmit="salvarCliente(event)">
                    <input type="hidden" id="clienteId">
                    <div class="form-group">
                        <label for="nome">Nome *</label>
                        <input type="text" id="nome" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email">
                    </div>
                    <div class="form-group">
                        <label for="telefone">Telefone</label>
                        <input type="tel" id="telefone">
                    </div>
                    <div class="form-group">
                        <label for="nif">NUIT *</label>
                        <input type="text" id="nif" required>
                    </div>
                    <div class="form-group">
                        <label for="morada">Morada</label>
                        <textarea id="morada" rows="3"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="fecharModalCliente()">Cancelar</button>
                        <button type="submit" class="btn-primary">Guardar Cliente</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Preview da Fatura -->
    <div id="faturaPreview" class="modal">
        <div class="modal-content fatura-preview">
            <div class="modal-header">
                <h3>Pré-visualização da Fatura</h3>
                <button class="btn-close" onclick="fecharPreview()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="fatura-content" id="faturaContent">
                    <!-- Conteúdo da fatura será gerado aqui -->
                </div>
                <div class="preview-actions">
                    <button class="btn-secondary" onclick="fecharPreview()">
                        <i class="fas fa-edit"></i> Editar
                    </button>
                    <button class="btn-primary" onclick="imprimirFatura()">
                        <i class="fas fa-print"></i> Imprimir
                    </button>
                    <button class="btn-success" onclick="downloadPDF()">
                        <i class="fas fa-download"></i> PDF
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="downloadPDF.js"></script>

</body>
</html>